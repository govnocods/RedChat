<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RedChat üí¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .message-animation {
        animation: slideIn 0.3s ease-out;
      }
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: rgba(220, 38, 38, 0.1);
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb {
        background: rgba(220, 38, 38, 0.3);
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: rgba(220, 38, 38, 0.5);
      }
      body {
        background-color: #0a0e27;
      }
      @media (max-width: 768px) {
        .sidebar-mobile {
          transform: translateX(-100%);
          transition: transform 0.3s ease-in-out;
        }
        .sidebar-mobile.open {
          transform: translateX(0);
        }
      }
      i[data-lucide="chevron-left"] {
        transition: transform 0.3s ease-in-out;
      }
      i[data-lucide="chevron-left"] {
        transition: transform 0.3s ease-in-out;
      }
    </style>
  </head>
  <body class="h-screen flex flex-col overflow-hidden">
    <!-- Overlay –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
    <div 
      id="sidebarOverlay"
      class="md:hidden fixed inset-0 bg-black/50 z-40 hidden"
    ></div>

    <div class="flex flex-1 overflow-hidden">
      <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
      <aside 
        id="sidebar"
        class="sidebar-mobile fixed md:static inset-y-0 left-0 z-40 w-80 bg-[#0f1422]/95 md:bg-[#0f1422]/90 backdrop-blur-xl border-r border-red-900/30 flex flex-col shadow-2xl"
      >
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ -->
        <div class="p-4 md:p-6 border-b border-red-900/30">
          <div class="flex items-center justify-between mb-3 md:mb-4">
            <div class="flex items-center gap-2 md:gap-3">
              <div class="w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-red-600 to-red-700 rounded-xl flex items-center justify-center shadow-lg shadow-red-900/50">
                <i data-lucide="message-circle" class="w-5 h-5 md:w-6 md:h-6 text-white"></i>
              </div>
              <h1 class="text-xl md:text-2xl font-bold bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent">
                RedChat
              </h1>
            </div>
            <div class="flex items-center gap-2">
              <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
              <button 
                id="sidebarClose"
                class="md:hidden p-2 hover:bg-red-900/20 rounded-xl transition-colors duration-200"
                title="–ó–∞–∫—Ä—ã—Ç—å"
              >
                <i data-lucide="x" class="w-5 h-5 text-gray-400"></i>
              </button>
              <button 
                id="newChatBtn"
                class="hidden md:block p-2.5 hover:bg-red-900/20 rounded-xl transition-colors duration-200 group"
                title="–ù–æ–≤—ã–π —á–∞—Ç"
              >
                <i data-lucide="plus" class="w-5 h-5 text-gray-400 group-hover:text-red-400 transition-colors"></i>
              </button>
            </div>
          </div>
          
          <!-- –ü–æ–∏—Å–∫ -->
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i data-lucide="search" class="w-4 h-4 text-gray-500"></i>
            </div>
            <input
              type="text"
              placeholder="–ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤..."
              class="w-full pl-10 pr-4 py-2 md:py-2.5 bg-[#0a0e27]/60 border border-red-900/30 rounded-xl text-white placeholder-gray-500 text-xs md:text-sm focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-red-600/50 transition-all duration-200"
            />
          </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
        <div id="chat-list" class="flex-1 overflow-y-auto p-2 md:p-3 space-y-2">
          <div
            class="p-3 md:p-4 flex items-center gap-2 md:gap-3 cursor-pointer hover:bg-red-900/20 active:bg-red-900/30 rounded-xl transition-all duration-200 bg-red-900/10 border border-red-900/30 group chat-item"
            id="general-chat"
            data-chat-name="–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π —á–∞—Ç"
            data-chat-name="–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π —á–∞—Ç"
          >
            <div class="relative">
              <div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-red-600 to-red-700 rounded-xl flex items-center justify-center font-bold text-white shadow-lg shadow-red-900/50 group-hover:scale-110 transition-transform duration-200">
                <i data-lucide="users" class="w-5 h-5 md:w-6 md:h-6"></i>
              </div>
              <span class="absolute -top-1 -right-1 w-3 h-3 md:w-4 md:h-4 bg-red-500 border-2 border-[#0a0e27] rounded-full"></span>
            </div>
            <div class="flex-1 min-w-0">
              <p class="font-semibold text-white text-sm md:text-base truncate">–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π —á–∞—Ç</p>
              <p class="text-gray-400 text-xs md:text-sm truncate hidden md:block">–û—Å–Ω–æ–≤–Ω–æ–π –æ–±—â–∏–π —á–∞—Ç</p>
            </div>
          </div>
        </div>

        <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="p-3 md:p-4 border-t border-red-900/30 bg-[#0a0e27]/40">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2 md:gap-3 flex-1 min-w-0">
              <div class="w-9 h-9 md:w-10 md:h-10 bg-gradient-to-br from-red-600 to-red-700 rounded-xl flex items-center justify-center font-bold text-white shadow-lg shadow-red-900/50">
                <span id="profileInitial" class="text-xs md:text-sm">?</span>
              </div>
              <div class="flex-1 min-w-0">
                <p id="profileName" class="font-medium text-white text-xs md:text-sm truncate">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
              </div>
            </div>
            <button 
              id="logoutBtn" 
              class="p-2 md:p-2.5 hover:bg-red-900/30 rounded-xl transition-colors duration-200 group ml-2"
              title="–í—ã—Ö–æ–¥"
            >
              <i data-lucide="log-out" class="w-4 h-4 md:w-5 md:h-5 text-gray-400 group-hover:text-red-400 transition-colors"></i>
            </button>
          </div>
        </div>
      </aside>

      <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
      <main class="flex-1 flex flex-col bg-[#0f1422]/60 backdrop-blur-xl w-full">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ -->
        <header class="p-3 md:p-4 border-b border-red-900/30 bg-[#0a0e27]/40 backdrop-blur-sm flex items-center justify-between md:pl-4">
          <div class="flex items-center gap-2 md:gap-4 flex-1 min-w-0">
            <!-- –ö–Ω–æ–ø–∫–∞-—Å—Ç—Ä–µ–ª–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ -->
            <button
              id="sidebarToggle"
              class="p-1.5 md:p-2 hover:bg-red-900/20 rounded-lg transition-colors duration-200 group flex-shrink-0 -ml-1 md:ml-0"
              title="–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤"
            >
              <i data-lucide="chevron-left" class="w-5 h-5 md:w-6 md:h-6 text-gray-400 group-hover:text-red-400 transition-colors rotate-0 md:rotate-0"></i>
            </button>
            <div class="relative flex-shrink-0">
              <div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-red-600 to-red-700 rounded-xl flex items-center justify-center shadow-lg shadow-red-900/50 cursor-pointer hover:scale-105 transition-transform duration-200">
                <i data-lucide="users" class="w-5 h-5 md:w-6 md:h-6 text-white"></i>
              </div>
            </div>
            <div class="flex-1 min-w-0 cursor-pointer" id="chatHeaderInfo">
              <h2 class="font-semibold text-base md:text-lg text-white truncate">–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π —á–∞—Ç</h2>
              <p class="text-xs md:text-sm text-gray-400 flex items-center gap-2">
                <span class="w-1.5 h-1.5 md:w-2 md:h-2 bg-red-500 rounded-full flex-shrink-0"></span>
                <span class="truncate">–û–Ω–ª–∞–π–Ω: 12</span>
              </p>
            </div>
          </div>
          <div class="flex items-center gap-1 md:gap-2 flex-shrink-0">
            <button 
              class="hidden md:block p-2.5 hover:bg-red-900/20 rounded-xl transition-colors duration-200 group"
              title="–ü–æ–∏—Å–∫"
            >
              <i data-lucide="search" class="w-5 h-5 text-gray-400 group-hover:text-red-400 transition-colors"></i>
            </button>
            <button 
              class="p-2 md:p-2.5 hover:bg-red-900/20 rounded-xl transition-colors duration-200 group"
              title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
            >
              <i data-lucide="more-vertical" class="w-4 h-4 md:w-5 md:h-5 text-gray-400 group-hover:text-red-400 transition-colors"></i>
            </button>
          </div>
        </header>

        <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π -->
        <div id="messages" class="flex-1 overflow-y-auto bg-gradient-to-b from-transparent to-[#0a0e27]/40 p-3 md:p-6 space-y-2 md:space-y-3"></div>

        <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è -->
        <footer class="p-2 md:p-4 border-t border-red-900/30 bg-[#0a0e27]/40 backdrop-blur-sm safe-area-inset-bottom">
          <form id="messageForm" class="flex items-center gap-2 md:gap-3">
            <button 
              type="button"
              class="hidden md:block p-3 hover:bg-red-900/20 rounded-xl transition-colors duration-200 group flex-shrink-0"
              title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª"
            >
              <i data-lucide="paperclip" class="w-5 h-5 text-gray-400 group-hover:text-red-400 transition-colors"></i>
            </button>
            
            <input
              id="messageInput"
              type="text"
              placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
              class="flex-1 p-2.5 md:p-3 rounded-xl bg-[#0f1422]/60 border border-red-900/30 focus:ring-2 focus:ring-red-600 focus:outline-none text-white placeholder-gray-500 text-sm md:text-base transition-all duration-200"
              required
            />
            
            <button
              type="submit"
              class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white p-2.5 md:p-3 rounded-xl flex items-center justify-center shadow-lg shadow-red-900/50 hover:shadow-xl hover:shadow-red-900/60 transform hover:scale-105 active:scale-95 transition-all duration-200 flex-shrink-0"
              title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
            >
              <i data-lucide="send" class="w-4 h-4 md:w-5 md:h-5"></i>
            </button>
          </form>
        </footer>
      </main>
    </div>

    <script>
      lucide.createIcons();

      // ---- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–æ–∫–µ–Ω–∞ ----
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
      }

      function parseJwt(token) {
        try {
          const base64Url = token.split(".")[1];
          const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
          const jsonPayload = decodeURIComponent(
            atob(base64)
              .split("")
              .map(function (c) {
                return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);
              })
              .join("")
          );
          return JSON.parse(jsonPayload);
        } catch {
          return null;
        }
      }

      // ---- –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–æ–∫–µ–Ω–∞ ----
      // Middleware —É–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –µ—Å–ª–∏ –º—ã –∑–¥–µ—Å—å - –∑–Ω–∞—á–∏—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã
      const token = getCookie("jwt");
      let username = "–ì–æ—Å—Ç—å";
      
      if (token) {
        const decoded = parseJwt(token);
        if (decoded) {
          username = decoded.Username || decoded.username || "–ì–æ—Å—Ç—å";
        }
      }

      document.getElementById("profileName").textContent = username;
      document.getElementById("profileInitial").textContent = username[0].toUpperCase();

      const form = document.getElementById("messageForm");
      const input = document.getElementById("messageInput");
      const messages = document.getElementById("messages");

      // ---- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è ----
      function displayMessage(msg) {
        // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤:
        // WebSocket: {username, content}
        // API: {Username, Content}
        const msgUsername = msg.username || msg.Username || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
        const msgContent = msg.content || msg.Content || "";

        const div = document.createElement("div");
        div.classList.add("flex", "items-start", "gap-3", "message-animation");

        div.innerHTML = `
          <div class="w-8 h-8 md:w-9 md:h-9 bg-gradient-to-br from-red-600 to-red-700 rounded-xl flex items-center justify-center font-bold text-white shadow-lg shadow-red-900/50 flex-shrink-0 text-xs md:text-sm">
            ${msgUsername[0] ? msgUsername[0].toUpperCase() : "?"}
          </div>
          <div class="flex-1 min-w-0">
            <div class="bg-[#0f1422]/80 backdrop-blur-sm border border-red-900/30 text-white p-2.5 md:p-3 rounded-xl rounded-tl-none shadow-lg max-w-[85%] md:max-w-md">
              <p class="text-red-400 font-medium text-xs md:text-sm mb-0.5 md:mb-1 truncate">${msgUsername}</p>
              <p class="text-gray-100 text-sm md:text-base break-words">${msgContent}</p>
            </div>
          </div>
        `;

        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
      }

      // ---- –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ----
      async function loadMessages() {
        try {
          const response = await fetch("/api/messages?limit=50", {
            method: "GET",
            credentials: "include",
            headers: {
              "Content-Type": "application/json",
            },
          });

          // –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ 401 (Unauthorized) - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–≥–∏–Ω
          if (response.status === 401) {
            document.cookie = "jwt=; Max-Age=0; path=/;";
            window.location.href = "/login";
            return;
          }

          if (!response.ok) {
            console.error("Failed to load messages:", response.status);
            return;
          }

          const messagesData = await response.json();
          
          // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
          messages.innerHTML = "";

          // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
          if (Array.isArray(messagesData)) {
            messagesData.forEach((msg) => {
              displayMessage(msg);
            });
          }
        } catch (error) {
          console.error("Error loading messages:", error);
        }
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      loadMessages();

      // ---- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WebSocket ----
      const wsProtocol = window.location.protocol === "https:" ? "wss:" : "ws:";
      const socket = new WebSocket(`${wsProtocol}//${window.location.host}/ws`);

      socket.onopen = () => {
        console.log("WebSocket connected");
      };

      socket.onerror = (error) => {
        console.error("WebSocket error:", error);
      };

      socket.onclose = (event) => {
        // –ö–æ–¥ 1008 = Policy Violation (–æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
        // –ö–æ–¥ 1002 = Protocol Error (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π)
        if (event.code === 1008 || event.code === 1002) {
          document.cookie = "jwt=; Max-Age=0; path=/;";
          window.location.href = "/login";
        } else if (event.code !== 1000) {
          // 1000 = Normal Closure (–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ)
          console.log("WebSocket closed:", event.code, event.reason);
        }
      };

      socket.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        displayMessage(msg);
      };

      // ---- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π ----
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const content = input.value.trim();
        if (!content) return;
        socket.send(JSON.stringify({ content, username }));
        input.value = "";
      });

      // ---- –í—ã—Ö–æ–¥ ----
      document.getElementById("logoutBtn").addEventListener("click", () => {
        document.cookie = "jwt=; Max-Age=0; path=/;";
        window.location.href = "/login";
      });

      // ---- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª—å—é ----
      const sidebar = document.getElementById("sidebar");
      const sidebarToggle = document.getElementById("sidebarToggle");
      const sidebarClose = document.getElementById("sidebarClose");
      const sidebarOverlay = document.getElementById("sidebarOverlay");
      const chatHeaderInfo = document.getElementById("chatHeaderInfo");
      const chevronIcon = sidebarToggle?.querySelector("i");

      function openSidebar() {
        sidebar.classList.add("open");
        sidebarOverlay.classList.remove("hidden");
        // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —Å—Ç—Ä–µ–ª–∫—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        if (chevronIcon) {
          chevronIcon.style.transform = "rotate(180deg)";
        }
      }

      function closeSidebar() {
        sidebar.classList.remove("open");
        sidebarOverlay.classList.add("hidden");
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–µ–ª–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
        if (chevronIcon) {
          chevronIcon.style.transform = "rotate(0deg)";
        }
      }

      // –û—Ç–∫—Ä—ã–≤–∞–µ–º/–∑–∞–∫—Ä—ã–≤–∞–µ–º –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Å—Ç—Ä–µ–ª–∫—É
      sidebarToggle?.addEventListener("click", (e) => {
        e.stopPropagation();
        if (sidebar.classList.contains("open")) {
          closeSidebar();
        } else {
          openSidebar();
        }
      });

      // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
      chatHeaderInfo?.addEventListener("click", () => {
        if (window.innerWidth < 768 && !sidebar.classList.contains("open")) {
          openSidebar();
        }
      });

      sidebarClose?.addEventListener("click", closeSidebar);
      sidebarOverlay?.addEventListener("click", closeSidebar);

      // –ó–∞–∫—Ä—ã–≤–∞–µ–º –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —á–∞—Ç–∞
      document.querySelectorAll(".chat-item").forEach((item) => {
        item.addEventListener("click", () => {
          const chatName = item.getAttribute("data-chat-name");
          if (chatName) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            const headerTitle = document.querySelector("header h2");
            if (headerTitle) {
              headerTitle.textContent = chatName;
            }
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            if (window.innerWidth < 768) {
              closeSidebar();
            }
          }
        });
      });

      // –ó–∞–∫—Ä—ã–≤–∞–µ–º –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ Esc
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && sidebar.classList.contains("open")) {
          closeSidebar();
        }
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ –ø–æ—Å–ª–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π —Å DOM
      lucide.createIcons();
    </script>
  </body>
</html>