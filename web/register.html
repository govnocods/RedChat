<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Регистрация — RedChat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      @keyframes blob {
        0%, 100% { transform: translate(0, 0) scale(1); }
        33% { transform: translate(30px, -50px) scale(1.1); }
        66% { transform: translate(-20px, 20px) scale(0.9); }
      }
      .animate-blob {
        animation: blob 7s infinite;
      }
      .animation-delay-2000 {
        animation-delay: 2s;
      }
      .animation-delay-4000 {
        animation-delay: 4s;
      }
      body {
        background-color: #0a0e27;
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center p-4">
    <!-- Фоновые эффекты -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="absolute -top-40 -right-40 w-80 h-80 bg-red-600 rounded-full mix-blend-multiply filter blur-xl opacity-15 animate-blob"></div>
      <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-red-700 rounded-full mix-blend-multiply filter blur-xl opacity-10 animate-blob animation-delay-2000"></div>
      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-red-500 rounded-full mix-blend-multiply filter blur-xl opacity-12 animate-blob animation-delay-4000"></div>
    </div>

    <div class="relative w-full max-w-md">
      <!-- Главная карточка -->
      <div class="bg-[#0f1422]/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-red-900/30 p-8 md:p-10">
        <!-- Логотип и заголовок -->
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-red-600 to-red-700 rounded-2xl mb-4 shadow-lg shadow-red-900/50">
            <i data-lucide="user-plus" class="w-8 h-8 text-white"></i>
          </div>
          <h1 class="text-4xl font-bold text-white mb-2 bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent">
            RedChat
          </h1>
          <p class="text-gray-300 text-sm">Создайте новый аккаунт</p>
        </div>

        <!-- Форма регистрации -->
        <form id="registerForm" class="space-y-6">
          <!-- Имя пользователя -->
          <div>
            <label for="username" class="block text-gray-200 text-sm font-medium mb-2 flex items-center gap-2">
              <i data-lucide="user" class="w-4 h-4 text-red-400"></i>
              Имя пользователя
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <i data-lucide="user" class="w-5 h-5 text-gray-500"></i>
              </div>
              <input
                type="text"
                id="username"
                name="username"
                required
                class="w-full pl-12 pr-4 py-3.5 bg-[#0a0e27]/60 border border-red-900/30 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-red-600/50 transition-all duration-200"
                placeholder="Введите имя пользователя"
              />
            </div>
          </div>

          <!-- Пароль -->
          <div>
            <label for="password" class="block text-gray-200 text-sm font-medium mb-2 flex items-center gap-2">
              <i data-lucide="lock" class="w-4 h-4 text-red-400"></i>
              Пароль
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <i data-lucide="lock" class="w-5 h-5 text-gray-500"></i>
              </div>
              <input
                type="password"
                id="password"
                name="password"
                required
                class="w-full pl-12 pr-4 py-3.5 bg-[#0a0e27]/60 border border-red-900/30 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-red-600/50 transition-all duration-200"
                placeholder="Введите пароль"
              />
            </div>
          </div>

          <!-- Кнопка регистрации -->
          <button
            type="submit"
            class="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold py-3.5 rounded-xl transition-all duration-200 shadow-lg shadow-red-900/50 hover:shadow-xl hover:shadow-red-900/60 transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2"
          >
            <i data-lucide="user-plus" class="w-5 h-5"></i>
            <span>Зарегистрироваться</span>
          </button>
        </form>

        <!-- Сообщение об ошибке -->
        <div id="error" class="mt-4 hidden p-4 bg-red-900/30 border border-red-700/50 rounded-xl text-red-200 text-sm flex items-center gap-2">
          <i data-lucide="alert-circle" class="w-5 h-5 flex-shrink-0"></i>
          <span id="errorText"></span>
        </div>

        <!-- Ссылка на вход -->
        <div class="mt-6 text-center">
          <p class="text-gray-400 text-sm">
            Уже есть аккаунт?
            <a href="/login" class="text-red-500 hover:text-red-400 font-medium transition-colors duration-200 inline-flex items-center gap-1">
              Войти
              <i data-lucide="arrow-right" class="w-4 h-4"></i>
            </a>
          </p>
        </div>
      </div>

      <!-- Дополнительная информация -->
      <p class="text-center text-gray-500 text-xs mt-6">
        Безопасное соединение
        <i data-lucide="shield-check" class="w-3 h-3 inline-block ml-1 text-red-500"></i>
      </p>
    </div>

    <script>
      lucide.createIcons();

      const form = document.getElementById("registerForm");
      const errorBox = document.getElementById("error");
      const errorText = document.getElementById("errorText");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Скрываем предыдущие ошибки
        errorBox.classList.add("hidden");
        errorText.textContent = "";

        try {
          const formData = new FormData(form);
          const data = {};
          for (let [key, value] of formData.entries()) {
            data[key] = value;
          }

          const res = await fetch("/api/register", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          if (res.ok) {
            // ✅ Успешная регистрация
            window.location.href = "/login";
          } else {
            // ❌ Ошибка регистрации
            const text = await res.text();
            errorText.textContent = text || "Ошибка регистрации";
            errorBox.classList.remove("hidden");
          }
        } catch (err) {
          console.error(err);
          errorText.textContent = "Ошибка сети";
          errorBox.classList.remove("hidden");
        }
      });
    </script>
  </body>
</html>